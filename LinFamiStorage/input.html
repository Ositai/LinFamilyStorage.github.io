<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Form</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
    <!-- Include Bootstrap CSS JS for second confirm model-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- å¼•ç”¨Bootstrap Library Date picker -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>

    <!-- è¼‰å…¥å…±ç”¨éƒ¨åˆ†ï¼Œéœæ…‹éƒ¨ç½²ç”¨ -->
    <link rel="stylesheet" href="https://ositai.github.io/LinFamilyStorage.github.io/LinFamiStorage/common.css">
    <script src="https://ositai.github.io/LinFamilyStorage.github.io/LinFamiStorage/common.js" defer></script>

    <script>
      /////// å…¥åº«åŠŸèƒ½ ///////
      // æª¢æŸ¥å¿…å¡«
      function requireTest(){
        let name = document.getElementById('name').value
        let numberAdd = document.getElementById('numAdd').value
        let price = document.getElementById('price').value
        let numMin = document.getElementById('numMin').value
        let expireDay = document.getElementById('expireDay').value
        let leftDay = document.getElementById('leftDay').value

        if (!name){
          alert('ç‰©å“æ¬„ä½ç©ºç™½')
          return
        } else if (!numberAdd){
          alert('æ•¸é‡ç‚ºç©ºç™½')
          return
        } 
        if (!price || !numMin){
          alert('åƒ¹æ ¼èˆ‡é æœŸåº«å­˜æœªå¡«å°‡é»˜èªç‚º0')
        }
        showModel()
      }

      // é¡¯ç¤ºäºŒæ¬¡ç¢ºèªè¦–çª—
      function showModel(){
        let name = document.getElementById('name').value
        let area = document.getElementById('area').value
        let position = document.getElementById('posi').value
        let price = document.getElementById('price').value
        let numberAdd = document.getElementById('numAdd').value
        let numberMin = document.getElementById('numMin').value
        let expireDay = document.getElementById('expireDay').value
        let leftDay = document.getElementById('leftDay').value
        let buyDay = document.getElementById('buyDay').value

        // é¿å…æ™‚é–“ç©ºç™½
        if (!expireDay && !leftDay){
          leftDay = 'ç„¡æœŸé™'
          expireDay = 'ç„¡æœŸé™'
        } else if (!expireDay){
          let bDay = new Date(buyDay).getTime()
          expireDay = new Date(bDay + leftDay*1000*60*60*24)
          // ä¿®æ­£å½¢å¼
          if (expireDay.getMonth()>8){
            dash1 = '-'    
          } else {dash1 = '-0'}
          if (expireDay.getDate()<10){
            dash2 = '-0'
          } else {dash2 = '-'}
          expireDay = expireDay.getFullYear() + dash1 + (expireDay.getMonth()+1) + dash2 + expireDay.getDate()      
        } else { //åªæœ‰å¡«å‰©é¤˜æ—¥æœŸ
          leftDay = (new Date(expireDay).getTime() - new Date(buyDay).getTime())/1000/60/60/24
        }

        if (!price){price=0}
        if (!numberMin){numberMin=0}

        let dataArr = [[name,'ç‰©å“å'],[area,'å€åŸŸ'],[position,'ä½ç½®'],[price,'åƒ¹æ ¼'],[numberAdd,'æ–°å¢æ•¸é‡'],
        [numberMin,'åº«å­˜ä¸‹é™'],[buyDay,'è³¼è²·æ—¥æœŸ'],[expireDay,'éæœŸæ—¥æœŸ'],[leftDay,'ä¿å­˜æ™‚é•·']]

        let inputData = dataArr
          .map(data =>
            `${data[1]} : ${data[0]}`
          )
          .join('\n')

        document.getElementById('modelContent')
          .innerText = inputData;
        $('#confirmationModal').modal('toggle')
        return undefined
      }

      /////// è‡ªå‹•æ¯”å°åŠŸèƒ½ ////////
      // é¡¯ç¤ºæœå°‹çµæœè¡¨æ ¼
      function displayResult(dataArray){
        
        if (dataArray && dataArray!==undefined && dataArray.length !=0){
          
          // å¦‚æœæœ‰çµæœï¼Œå®šç¾©é¡¯ç¤ºæ ¼å¼
          let headerInput = "<p style='text-align: center'>æœ‰é‡è¤‡åç¨±çš„åº«å­˜ï¼Œæ˜¯å¦ä½µå…¥?</p>\n"+
            "<table class='table table-sm table-striped' id='dtable' style='font-size: 20px;'>"+
            "<thead style='white-space: nowrap;'>"+"<tr>"+
            // headers
            `${tableHeader}`+"</tr></thead>"

          let tableBody = ''
          // è¿´åœˆé¡¯ç¤ºè¡¨æ ¼å…ƒç´ ï¼Œä¸¦å„²å­˜areaèˆ‡index          
          dataArray.forEach(arr => {
            dataArea.push(arr.area)
            dataIndex.push(arr.index)

            let tableRowBody = arr.data
              .map(dat => {
                `<td>${dat}</td>`
              }).join()
            tableBody +=  `<tr>${tableRowBody}<td>`+
                          '<input type="radio" name=replaceCheck>'+ //åˆä½µè‡³å·²æœ‰åº«å­˜checkbox
                          '</td></tr>'
          })

          let result = `${headerInput}${tableBody}</table>`

          let div = document.getElementById('search-results')
          div.innerHTML = result
          div.style.display = 'block'

          // é¡¯ç¤ºæ›´æ–°åº«å­˜é‡æŒ‰éˆ•
          const showButton = document.getElementById('updateNum')
          showButton.style.display = 'block'

          // è¼¸å…¥é€²éš±è—è®Šæ•¸
          document.getElementById('dataArea').value = dataArea
          document.getElementById('dataIndex').value = dataIndex
        } else{
          let div = document.getElementById('search-results')
          div.innerHTML = 'æŸ¥ç„¡æ­¤åº«å­˜'
        }
        return undefined
      }

      // å‚³é€æ–°å¢åº«å­˜è³‡æ–™
      function getValues(){
        let name = document.getElementById('name').value
        let area = document.getElementById('area').value
        let position = document.getElementById('posi').value
        let price = document.getElementById('price').value
        let numberAdd = document.getElementById('numAdd').value
        let numberMin = document.getElementById('numMin').value
        let expireDay = document.getElementById('expireDay').value
        let leftDay = document.getElementById('leftDay').value
        let buyDay = document.getElementById('buyDay').value

        // é¿å…æ™‚é–“ç©ºç™½
        if (!expireDay && !leftDay){
          leftDay = 'ç„¡æœŸé™'
          expireDay = 'ç„¡æœŸé™'
        } else if (!expireDay){
          let bDay = new Date(buyDay).getTime()
          expireDay = new Date(bDay + leftDay*1000*60*60*24)
          // ä¿®æ­£å½¢å¼
          if (expireDay.getMonth()>8){
            dash1 = '-'    
          } else {dash1 = '-0'}
          if (expireDay.getDate()<10){
            dash2 = '-0'
          } else {dash2 = '-'}
          expireDay = expireDay.getFullYear() + dash1 + (expireDay.getMonth()+1) + dash2 + expireDay.getDate()
        } else { //åªæœ‰å¡«å‰©é¤˜æ—¥æœŸ
          leftDay = (new Date(expireDay).getTime() - new Date(buyDay).getTime())/1000/60/60/24
        }
        if (!price){price=0}
        if (!numberMin){numberMin=0}

        let rowData={
          name:name,
          area:area,
          position:position,
          price:price,
          numberAdd:numberAdd,
          numberMin:numberMin,
          expireDay:expireDay,
          leftDay:leftDay,
          buyDay:buyDay
        }

        // upload
        fetch(scriptUrl, {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'add',
            storageChange: rowData
            })
        })
        .then(res => res.json())
        .then(({success, message}) => {
          if (success) {
            // ä¸Šå‚³å®Œå¾Œæ¸…é™¤
            document.getElementById("myForm").reset()
            document.getElementById("search-results").style.display = 'none'
            document.getElementById('updateCheck').style.display = 'none'
            
            // å®Œæˆç¢ºèªè¨Šæ¯
            alert(message)
            
            //é‡è¨­è³¼è²·æ—¥ç‚ºç•¶å¤©æ—¥æœŸ     
            const today = new Date()
            const formattedDate = today.toISOString().slice(0, 10)
            document.getElementById('buyDay').value = formattedDate
          } else {
            console.error('Error sending data to Google Sheets:', message);
          }
        })
        .catch(error => {
          console.error('Fetch error:', error);
        });

        // é—œé–‰äºŒæ¬¡ç¢ºèªå°è©±æ¡†
        bootstrap.Modal
          .getInstance(document
            .getElementById('confirmationModal')
          )
        .hide()
        return undefined
      }
    </script>


  </head>

<!-- å¸ƒå±€èˆ‡é¸é … -->
<body>
<div class="container-contact">
<h2>LinFamiStorage</h2>
<div class="row">
  <div class="col-sm-2"></div>
  <div class="col-sm-8">
    <h3>æ–°å¢åº«å­˜</h3>
  </div>
  <div class="col-sm-2" style="text-align: right;">
    <button class="btn" style="font-size: 20px; max-width: fit-content;" id="backHome" onclick="linkToAdd('home')">
      ğŸ  Home</button>
  </div>
</div>

<!-- div class=row ç‚ºè±è‘—åˆ‡ -->
<div class="row">
  <!-- æ‰€æœ‰(col-sm-#)è¡¨ç¤ºåˆ†å‰²æˆæ•¸å€‹columnï¼Œä¸”#ç¸½å’Œå¿…é ˆç‚º12 -->
  <!-- å·¦è‡³å³ä¸‰å€åŸŸç¬¬ä¸€å€(ç©ºç™½) -->
  <!-- <div class="col-sm-1"></div> -->

  <!-- ä¸­é–“å€(å¡«å¯«å€) -->
  <div class="col-sm-12">
    <!-- formç”¢ç”Ÿè¡¨å–® -->
    <form id="myForm">

      <div class="row">
        <div class="col-sm-1"></div>
        
        <!-- ç‰©å“ -->
        <div class="col-sm-10 form-group">
          <!-- idæ˜¯ä¸²æµç‰©ä»¶çš„property -->          
          <input class="form-control" id="name" name="name"
          placeholder="ç‰©å“å" type="text"
          onblur="formSender(this)"  
          required>        
          <!-- onblur   = å–æ¶ˆé¸å– -->
          <!-- required = å¿…å¡«    -->
        </div>
        <div class="col-sm-1"></div> 
      </div>

      <div class="row">
      <!-- é€²è²¨æ™‚é–“ -->   
        <div class="col-sm-3">
          <p>è³¼å…¥æ—¥æœŸ:</p>
        </div>
        <div class="col-sm-4 form-group">
          <input type="date" class="form-control" id="buyDay" placeholder="è³¼å…¥æ—¥æœŸ">         
          <!-- é è¨­ç‚ºç•¶å¤©æ—¥æœŸ -->
          <script>
            const today = new Date();
            const formattedDate = today.toISOString().slice(0, 10);
            document.getElementById('buyDay').value = formattedDate;
          </script>
        </div>
      </div>

      <!-- åˆ†éš”ç·š -->
      <div style="height: 5px; width:100%; background-color: #327570"></div>

      <div class="row">
        <!-- æœ‰æ•ˆæœŸé™ -->
        <div class="col-sm-3">
          <p>æœ‰æ•ˆæœŸé™:</p>
        </div>
        <div class="col-sm-4 form-group">
          <input type="date" class="form-control" id="expireDay" placeholder="æœ‰æ•ˆæœŸé™">         
        </div>
        

        <!-- å‰©é¤˜æœ‰æ•ˆæ—¥æœŸ -->
        <div class="col-sm-1">
          <p>æˆ–</p>
        </div>
        <div class="col-sm-4 form-group">
          <input type="number" class="form-control" id="leftDay" placeholder="ä¿å­˜æ™‚é•·(å¤©)">         
        </div>
      </div>

      <!-- åˆ†éš”ç·š -->
      <div style="height: 5px; width:100%; background-color: #327570"></div>

      <div class="row">
        <div class="col-sm-2"></div>
        

        <!-- å…ˆé¸å€åŸŸ -->
        <div class="col-sm-4 form-group">         
          <label for="area" style="font-size: 20px" >åº«å­˜å€åŸŸ:</label>
          <select id="area" class="form-control">
            <option value="1F">1F</option>
            <option value="2F">2F</option>
            <option value="3F">3F</option>
            <option value="storage">storage</option>
          </select>
        </div>

        <!-- å†é¸ä½ç½® -->
        <div class="col-sm-4 form-group">
          <label for="posi style="style="font-size: 20px">åº«å­˜ä½ç½®:</label>
          <select id="posi" class="form-control">
          <!-- æ ¹æ“šä¸åŒå€åŸŸè…³æœ¬ç”Ÿæˆä½ç½®æ¸…å–® -->
          </select>  
        </div>
        <!-- å€åŸŸ-ä½ç½® å…©æ®µå¼æ¸…å–®è…³æœ¬ -->
        <script>
          const pos = {"1F":['å†°ç®±','å»šæˆ¿-ä¸­å³¶','å»šæˆ¿-æµç†è‡ºæŠ½å±œ','å»šæˆ¿-ç±³æ«ƒ','å»šæˆ¿-ä¸Šæ–¹æ«ƒ','é£¯å»³å¤–-é‹æ«ƒ','å®¢å»³-é‹æ«ƒ','å®¢å»³-é›»è¦–æ«ƒ','å®¢å»³-æ¡Œå­','é£¯å»³-è—¥æ«ƒ','é£¯å»³-æ¡Œé‚Šæ«ƒ','é£¯å»³-é¤å…·æ«ƒ','å»æ‰€1F'],"2F":['æ›¸æˆ¿-æ›¸æ«ƒA','æ›¸æˆ¿-æ›¸æ«ƒB','æ›¸æˆ¿-æŠ½å±œ','å»æ‰€2F','å»æ‰€2.5F','å“¥æˆ¿é–“','å¦¹æˆ¿é–“','å®¢æˆ¿'],"3F":['ä¼‘é–’å®¤','ç¥å»³','å»æ‰€3F','ä¸»è‡¥'],"storage":['å„²è—å®¤A1','å„²è—å®¤A2','å„²è—å®¤A3','å„²è—å®¤A4','å„²è—å®¤Aæ›','å„²è—å®¤B1','å„²è—å®¤B2','å„²è—å®¤C','é–£æ¨“','2Få„²è—å®¤']}

          function  genPosition(){
            const areaS = document.getElementById('area')
            const posiS = document.getElementById('posi')
            const selectedArea = areaS.value

            // åˆªé™¤èˆŠæœ‰ä½ç½®æ¸…å–®
            posiS.innerHTML=''
            // æ›´æ–°ä½ç½®æ¸…å–®
            pos[selectedArea].forEach(position =>{
              const option = document.createElement('option')
              option.value = position
              option.textContent = position
              posiS.appendChild(option)
            })
          }
          // Attach event listener to first dropdown
          document.getElementById('area').addEventListener('change',genPosition)

          // Initial population on page load
          genPosition()
        </script>

        <div class="col-sm-2"></div>
        
      </div>

      <!-- åˆ†éš”ç·š -->
      <div style="height: 5px; width: 100%; background-color: #327570"></div>

      <div class="row">

        <!-- åƒ¹æ ¼ -->
        <div class="col-sm-4 form-group">          
          <input class="form-control" id="price" name="name"
          placeholder="åƒ¹æ ¼" type="number">        
        </div>

        <!-- æ–°å¢æ•¸é‡ -->
        <div class="col-sm-4 form-group">          
          <input class="form-control" id="numAdd" name="name"
          placeholder="æ–°å¢æ•¸é‡" type="number" required>        
        </div>

        <!-- åº«å­˜ä¸‹ç·š -->
        <div class="col-sm-4 form-group">          
          <input class="form-control" id="numMin" name="name"
          placeholder="ä¸‹é™åº«å­˜" type="number" required>        
        </div>
      </div>
        
      <br>
      <br>

      <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-md-8 form-group">
          <button class="btn " type="button" id="submitButton" onclick="requireTest()">é€å‡ºSubmit</button>
          </div>
        <div class="col-sm-2"></div>
      </div>
    </form>
  </div>

  <!-- é‡è¤‡ç‰©å“è¡¨æ ¼åœ¨æ­¤ -->
  <div class="row">
    <div id="search-results" class="my-table-wrapper table-reponsive">  
    </div>
  </div>

  <!-- -äºŒæ¬¡ç¢ºèªæ¨¡æ¿ -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-header">
            <h5 class="modal-title" id="confirmationModalLabel" style="color: black">Confirm Submissionæ·»åŠ ç¢ºèª</h5>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="modal-body">
            <!-- Display submitted data here -->
            <p id="modelContent" style="color: black; text-align: left"></p>
            
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">âŒCancelé—œé–‰</button>
            <button type="submit" class="btn btn-primary" id="confirmButton">â­•Confirmç¢ºèª</button>
            <script>
              // ç¢ºèªé€å‡ºæŒ‰ä¸‹å¾Œ
              document.getElementById('confirmButton')
                .addEventListener("click",getValues)
            </script>
        </div>
      </div>
    </div>
  </div>

  <!-- å·¦è‡³å³ä¸‰å€åŸŸç¬¬ä¸‰å€(ç©ºç™½) -->
  <!-- <div class="col-sm-2"></div> -->
  

</div>
</div>
<!-- å®Œæˆç¶²é é¡¯ç¤º -->
</body>

</html>







